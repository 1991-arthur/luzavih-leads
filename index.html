<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Luzavih ‚ú®</title>

  <!-- Google Tag Manager -->
  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://gtm-server-side-render.onrender.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MZT4DCTR');
  </script>
  <!-- End Google Tag Manager -->

  <style>
    :root {
      --bg-color: #f7f1e8;
      --text-color: #444;
      --accent: #c7a45d;
      --accent-dark: #a78a50;
      --font: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --error: #e74c3c;
    }

    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: var(--font);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .wrapper {
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      max-width: 420px;
      width: 100%;
      padding: 2.2rem 2rem 2.5rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .wrapper::before {
      content: '';
      position: absolute;
      width: 160%;
      height: 160%;
      background: radial-gradient(circle at top, rgba(199,164,93,0.15), transparent 60%);
      top: -40%;
      left: -30%;
      z-index: -1;
    }

    img.logo {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      margin-bottom: 1.2rem;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.06);
      object-fit: cover;
      background: #fdf7ef;
    }

    h1 {
      font-weight: 600;
      font-size: 1.6rem;
      margin-bottom: 0.4rem;
    }

    p.desc {
      font-size: 0.95rem;
      margin-bottom: 1.6rem;
      color: #666;
    }

    form {
      text-align: left;
      margin-top: 0.5rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    label {
      display: block;
      font-size: 0.88rem;
      font-weight: 500;
      color: #555;
      margin-bottom: 0.35rem;
    }

    input,
    select {
      width: 100%;
      padding: 0.8rem 0.9rem;
      border-radius: 10px;
      border: 1.8px solid #e0e0e0;
      font-size: 0.95rem;
      outline: none;
      transition: all 0.25s ease;
      background-color: #faf7f1;
    }

    input:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(199, 164, 93, 0.18);
      background-color: #fffdf8;
    }

    .error {
      color: var(--error);
      font-size: 0.78rem;
      margin-top: 0.2rem;
      display: none;
    }

    button {
      width: 100%;
      padding: 0.9rem 1rem;
      margin-top: 0.4rem;
      background: var(--accent);
      color: #fff;
      font-weight: 600;
      font-size: 0.98rem;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      transition: background 0.25s ease, transform 0.18s ease, box-shadow 0.18s ease;
    }

    button:hover {
      background: var(--accent-dark);
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
    }

    button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    /* SPINNER RESTAURADO */
    .loading {
      display: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.4);
      border-top-color: #fff;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    footer {
      font-size: 0.78rem;
      color: #999;
      margin-top: 1.6rem;
      text-align: center;
    }
  </style>
</head>
<body>

  <noscript>
    <iframe src="https://gtm-server-side-render.onrender.com/ns.html?id=GTM-MZT4DCTR"
            height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>

  <div class="wrapper">
    <img src="logo.jpg" alt="Logo Luzavih" class="logo" />

    <h1>Luzavih</h1>
    <p class="desc">
      Fabrica√ß√£o pr√≥pria.<br>
      Pe√ßas que vestem luz & prop√≥sito.<br>
      Entre em contato üåø
    </p>

    <form id="whatsappForm">
      <div class="form-group">
        <label for="nome">Nome completo</label>
        <input type="text" id="nome" required placeholder="Digite seu nome" />
        <div class="error" id="nomeError">Por favor, digite seu nome completo.</div>
      </div>

      <div class="form-group">
        <label for="telefone">Telefone / WhatsApp</label>
        <input type="tel" id="telefone" required placeholder="(00) 00000-0000" />
        <div class="error" id="telefoneError">Por favor, digite um telefone v√°lido.</div>
      </div>

      <div class="form-group">
        <label for="tipo">Voc√™ √©:</label>
        <select id="tipo" required>
          <option value="">Selecione uma op√ß√£o</option>
          <option value="atacado">Lojista / Atacado</option>
          <option value="varejo">Cliente final / Varejo</option>
        </select>
        <div class="error" id="tipoError">Por favor, selecione uma op√ß√£o.</div>
      </div>

      <button type="submit" id="submitBtn">
        <span id="btnText">Continuar no WhatsApp</span>
        <div class="loading" id="loading"></div>
        <svg id="whatsappIcon" width="20" height="20" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7
                   8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8
                   8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1
                   8 8v.5z" />
          <path d="M16 12.5c-.25-.12-1.47-.72-1.7-.8-.22-.08-.38-.12-.55.12-.16.25-.63.8-.77.96-.14.16-.29.18-.54.06-.25-.12-1.05-.39-2-1.25-.74-.66-1.24-1.47-1.39-1.72-.14-.25-.01-.38.11-.5.12-.12.25-.29.37-.43.12-.14.16-.25.24-.41.08-.16.04-.31-.02-.43-.06-.12-.55-1.32-.76-1.81-.2-.48-.4-.42-.55-.43l-.47-.01c-.16 0-.41.06-.63.29-.22.22-.83.81-.83 1.98 0 1.17.85 2.3.97 2.46.12.16 1.67 2.55 4.04 3.58.56.24.99.38 1.33.49.56.18 1.07.15 1.47.09.45-.07 1.47-.6 1.68-1.18.21-.58.21-1.08.15-1.18-.06-.1-.22-.16-.47-.28z" />
        </svg>
      </button>
    </form>

    <footer>¬© 2025 Luzavih</footer>
  </div>

  <script>
      window.dataLayer = window.dataLayer || [];
  
      const CONFIG = {
        GOOGLE_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbyrFlU25VeJAC8Zm_tDQdJxjMntAUfKnz7qJJqpgrnkMSeKqFrhIDDBS15a5aOPHAQJ/exec',
        WHATSAPP_ATACADO: '5547992586911',
        WHATSAPP_VAREJO: '5547992126929',
        WHATSAPP_MESSAGE: 'Ol√°! Adorei o conte√∫do e gostaria de mais informa√ß√µes.'
      };
  
      function formatPhone(value) {
        value = value.replace(/\D/g, '');
        if (value.length <= 10) {
          value = value.replace(/(\d{2})(\d)/, '($1) $2');
          value = value.replace(/(\d{4})(\d)/, '$1-$2');
        } else {
          value = value.replace(/(\d{2})(\d)/, '($1) $2');
          value = value.replace(/(\d{5})(\d)/, '$1-$2');
        }
        return value;
      }
  
      document.getElementById('telefone').addEventListener('input', function(e) {
        e.target.value = formatPhone(e.target.value);
      });
  
      // Fun√ß√£o de padroniza√ß√£o de telefone (E.164)
      function normalizePhone(raw) {
        let phone = raw.replace(/\D/g, '');
        phone = phone.replace(/^0+/, '');
  
        if (phone.length === 10 || phone.length === 11) {
          phone = '55' + phone;
        }
  
        return phone;
      }
  
      function getFBCLID() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('fbclid') || '';
      }
  
      function getFBC() {
        const fbclid = getFBCLID();
        if (fbclid) return 'fb.1.' + Date.now() + '.' + fbclid;
        return '';
      }
  
      function getFBP() {
        const match = document.cookie.match(/_fbp=([^;]+)/);
        return match ? match[1] : '';
      }
  
      // ------------------------------
      // FUN√á√ÉO FINAL CORRETA DE UTMs
      // ------------------------------
      function getUTMs() {
        const params = new URLSearchParams(window.location.search);
  
        const utmKeys = [
          "utm_source",
          "utm_medium",
          "utm_campaign",
          "utm_id",
          "utm_content",
          "utm_term"
        ];
  
        let utms = {};
  
        utmKeys.forEach(key => {
          const valueFromURL = params.get(key);
  
          if (valueFromURL) {
            sessionStorage.setItem(key, valueFromURL);
            utms[key] = valueFromURL;
          } else {
            utms[key] = sessionStorage.getItem(key) || "";
          }
        });
  
        return utms;
      }
  
      window.dataLayer.push({
        event: 'page_view',
        page_title: document.title,
        page_location: window.location.href
      });
  
      function validateForm(nome, telefone, tipo) {
        let isValid = true;
  
        if (nome.trim().length < 3) {
          document.getElementById('nomeError').style.display = 'block';
          isValid = false;
        } else {
          document.getElementById('nomeError').style.display = 'none';
        }
  
        const telefoneNumeros = telefone.replace(/\D/g, '');
        if (telefoneNumeros.length < 10) {
          document.getElementById('telefoneError').style.display = 'block';
          isValid = false;
        } else {
          document.getElementById('telefoneError').style.display = 'none';
        }
  
        if (!tipo) {
          document.getElementById('tipoError').style.display = 'block';
          isValid = false;
        } else {
          document.getElementById('tipoError').style.display = 'none';
        }
  
        return isValid;
      }
  
      async function sendToGoogleSheets(data) {
        try {
          await fetch(CONFIG.GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
          });
        } catch (error) {
          console.error('Erro ao enviar dados:', error);
        }
      }
  
      function getWhatsappNumber(tipo) {
        return tipo === 'atacado' ? CONFIG.WHATSAPP_ATACADO : CONFIG.WHATSAPP_VAREJO;
      }
  
      function redirectToWhatsApp(tipo) {
        const message = encodeURIComponent(CONFIG.WHATSAPP_MESSAGE);
        const number = getWhatsappNumber(tipo);
        const whatsappURL = `https://wa.me/${number}?text=${message}`;
        window.location.href = whatsappURL;
      }
  
      document.getElementById('whatsappForm').addEventListener('submit', async function(e) {
        e.preventDefault();
  
        const nome = document.getElementById('nome').value;
        const telefoneOriginal = document.getElementById('telefone').value;
        const tipo = document.getElementById('tipo').value;
  
        if (!validateForm(nome, telefoneOriginal, tipo)) return;
  
        // Ativa spinner
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const loading = document.getElementById('loading');
        const whatsappIcon = document.getElementById('whatsappIcon');
  
        submitBtn.disabled = true;
        btnText.textContent = 'Enviando...';
        loading.style.display = 'block';
        whatsappIcon.style.display = 'none';
  
        const normalizedPhone = normalizePhone(telefoneOriginal);
  
        // ‚úî CORRE√á√ÉO AQUI ‚Üì‚Üì‚Üì
        const utms = getUTMs();
  
        // Envia ao Google Sheets
        await sendToGoogleSheets({
          nome: nome,
          telefone: normalizedPhone,
          tipo: tipo,
          fbclid: getFBCLID(),
          ...utms
        });
  
        const eventId = 'lead_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
  
        window.dataLayer.push({
          event: tipo === 'atacado' ? 'lead_atacado_submit' : 'lead_varejo_submit',
          event_id: eventId,
          event_name: tipo === 'atacado' ? 'LeadAtacado' : 'LeadVarejo',
          lead_type: tipo,
          user_data: {
            phone_number: normalizedPhone,
            address: {
              first_name: nome.split(' ')[0],
              last_name: nome.split(' ').slice(1).join(' ')
            }
          },
          fbclid: getFBCLID(),
          fbc: getFBC(),
          fbp: getFBP(),
          lead_name: nome,
          lead_phone: normalizedPhone
        });
  
        setTimeout(() => {
          redirectToWhatsApp(tipo);
        }, 500);
      });
  
      document.addEventListener("DOMContentLoaded", () => {
        document.body.style.opacity = 0;
        document.body.style.transition = "opacity 0.6s ease";
        setTimeout(() => (document.body.style.opacity = 1), 50);
      });
  </script>
  
</body>
</html>
